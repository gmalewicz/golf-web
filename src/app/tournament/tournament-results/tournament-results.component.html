<div *ngIf="!display" class="d-flex justify-content-center">
  <span class="spinner-border text-success" style="width: 3rem; height: 3rem;" role="status"></span>
</div>
<div *ngIf="display">
  <h2>
    <span i18n="@@tourRes-hdr">Tournament Results: </span>
    {{tournament.name}}
    <span *ngIf="tournament.bestRounds > 0">
      <span i18n="@@tourRes-bst"> - best </span>
      {{tournament.bestRounds}}
      <span i18n="@@tourRes-rnds"> round(s)</span>
    </span>
  </h2>

  <br/>
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" id="stbNet-tab" data-bs-toggle="tab" data-bs-target="#all" type="button"
        role="tab" aria-controls="stbNet" aria-selected="true" (click)="updateSort(0)" i18n="@@tourRes-stbNet">STB Net</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="stb-tab" data-bs-toggle="tab" data-bs-target="#all" type="button"
        role="tab" aria-controls="stb" aria-selected="false" (click)="updateSort(1)">STB</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="strokes-tab" data-bs-toggle="tab" data-bs-target="#all" type="button"
        role="tab" aria-controls="strokes" aria-selected="false" (click)="updateSort(2)" i18n="@@tourRes-str">Strokes</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="netStroke-tab" data-bs-toggle="tab" data-bs-target="#all" type="button"
        role="tab" aria-controls="netStrokes" aria-selected="false" (click)="updateSort(3)" i18n="@@tourRes-strNet">Strokes Net</button>
    </li>
  </ul>
  <br/>

      <table class="table table-striped" aria-describedby="tournament result">
        <thead>
          <tr>
            <th id="place" i18n="@@tourRes-place">Place</th>
            <th id="player" i18n="@@tourRes-plr">Player</th>
            <th id="nstb" i18n="@@tourRes-stbNet">STB Net</th>
            <th id="gstb" i18n="@@tourRes-stb">STB</th>
            <th id="gstr" i18n="@@tourRes-strGross">Strokes</th>
            <th id="nstr" i18n="@@tourRes-strNet">Strokes Net</th>
            <th id="prnd" i18n="@@tourRes-plrRnds">Played Rounds</th>
          </tr>
        </thead>
        <tbody >
          <ng-container *ngFor="let tournamentResult of tournamentResults, let i = index">
            <tr>
              <td *ngIf="displayRound[i] == false">
                <span *ngIf="rndSpinner[i]" class="spinner-border spinner-border-sm mr-1"></span>
                <fa-icon [icon]="faSearchPlus" class="golf-green" (click)="showPlayerDetails(tournamentResult, i)"></fa-icon>
                &nbsp;
                {{i + 1}}
              </td>
              <td *ngIf="displayRound[i] == true">
                <fa-icon [icon]="faSearchMinus" class="golf-green" (click)="hidePlayerDetails(i)"></fa-icon>
                &nbsp;
                {{i + 1}}
              </td>
              <td>{{ tournamentResult.player.nick }}</td>
              <td>{{ tournamentResult.stbNet}}</td>
              <td>{{ tournamentResult.stbGross}}</td>
              <td *ngIf="tournamentResult.strokesBrutto === 0">x</td>
              <td *ngIf="tournamentResult.strokesBrutto !== 0">{{tournamentResult.strokesBrutto}}</td>
              <td *ngIf="tournamentResult.strokesNetto === 0">x</td>
              <td *ngIf="tournamentResult.strokesNetto !== 0">{{tournamentResult.strokesNetto}}</td>
              <td>
                {{ tournamentResult.playedRounds}}
                <span *ngIf="tournament.player.id === playerId">
                  <fa-icon [icon]="faMinusCircle" class="golf-green" (click)="deleteResult(tournamentResult.id)"></fa-icon>
                </span>
              </td>
            </tr>
            <tr *ngIf="tournamentResult.tournamentRounds != null && displayRound[i] == true then showDetails" class="d-flex justify-content-center"></tr>

            <ng-template #showDetails>
              <td colspan="6">
                <div>
                <table class="table table-striped" aria-describedby="tournament details">
                  <thead>
                    <tr>
                      <th id="no" i18n="@@tourRes-no">No</th>
                      <th id="cour" i18n="@@tourRes-course">Course</th>
                      <th id="nstb" i18n="@@tourRes-stbNet">STB Net</th>
                      <th id="gstb" i18n="@@tourRes-stb">STB</th>
                      <th id="gstr" i18n="@@tourRes-strGross">Strokes</th>
                      <th id="nstr" i18n="@@tourRes-strNet">Strokes Net</th>
                      <th id="sDiff" i18n="@@tourRes-scrDiff">Score Differential</th>
                    </tr>
                  </thead>
                  <tbody *ngFor="let tournamentRound of tournamentResult.tournamentRounds,  let j = index">
                    <td>{{j + 1}}</td>
                    <td>
                      <span *ngIf="tournamentRound.roundId !== null">
                        <fa-icon [icon]="faSearchPlus" class="golf-green" (click)="showPlayerRound(tournamentRound.roundId)"></fa-icon>
                        &nbsp;
                      </span>
                      {{tournamentRound.courseName}}
                    </td>
                    <td>{{tournamentRound.stbNet}}</td>
                    <td>{{tournamentRound.stbGross}}</td>
                    <td *ngIf="tournamentRound.strokes">{{tournamentRound.strokesBrutto}}</td>
                    <td *ngIf="!tournamentRound.strokes">x</td>
                    <td *ngIf="tournamentRound.strokes">{{tournamentRound.strokesNetto}}</td>
                    <td *ngIf="!tournamentRound.strokes">x</td>
                    <td>{{tournamentRound.scrDiff}}</td>
                  </tbody>
                </table>
                </div>
              </td>
            </ng-template>
          </ng-container>
        </tbody>
      </table>
  <div>
    <br />
    <button type="button" class="btn btn-success" routerLink="/home" i18n="@@tourRes-cancel">
      Cancel
    </button>
    &nbsp;
    <span *ngIf="tournament.player.id === playerId && tournament.status === false">
      <button type="button" class="btn btn-success"  routerLink ="/tournaments/tournamentRounds" [state]="{data: {tournament: tournament}}" i18n="@@tourRes-add">
        Add Round
      </button>
      &nbsp;
      <button type="button" class="btn btn-success"  routerLink ="/courses" [state]="{data: {parent: 'roundOnBehalf', tournament: tournament}}" i18n="@@tourRes-addBehf">
        Add Rounds on Behalf
      </button>
      &nbsp;
      <button id="close_btn" type="button" class="btn btn-success" (click)="closeTournament()">
        <span *ngIf="loadingClose" class="spinner-border spinner-border-sm mr-1"></span>
        <span i18n="@@tourRes-close">Close tournament</span>
      </button>
      &nbsp;
      <button type="button" class="btn btn-success del" (click)="deleteTournament()">
        <span *ngIf="loadingDelete" class="spinner-border spinner-border-sm mr-1"></span>
        <span i18n="@@tourRes-delete">Delete tournament</span>
      </button>
    </span>
  </div>
</div>
